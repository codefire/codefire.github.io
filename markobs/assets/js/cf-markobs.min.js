function MarkObsTestController(a,b,c){var d;d=this,d.debug="If you can see this, then MarkObsTestController is working :-)",d.html="",d.markob={},d.deletedItems=[],b.$watch("moCtrl.markob",function(a,b){d.html=c.trustAsHtml(d.generateHtmlCode())},!0),this.generateHtmlCode=function(){var a=document.createElement("div");if("undefined"!=typeof d.markob&&"undefined"!=typeof d.markob.items)for(var b in d.markob.items)if(d.markob.items.hasOwnProperty(b)){var c=d.markob.items[b],e=this.processItem(c);a.appendChild(e)}for(var f,g=document.createNodeIterator(a,NodeFilter.SHOW_ELEMENT),h=0,i="";f=g.nextNode();)h>0&&(i+=this.tagToHtml(f)+"\n"),h++;return i},this.processItem=function(a){var b=null;switch(a.type){case"heading":var c="h3";"undefined"!=typeof a.rank&&a.rank>=1&&a.rank<=6&&(c="h"+a.rank),b=document.createElement(c);var d=document.createTextNode(a.content);b.appendChild(d);break;case"paragraph":if(b=document.createElement("p"),"undefined"!=typeof a.content&&null!=a.content){var d=document.createTextNode(a.content);b.appendChild(d)}if("undefined"!=typeof a.items&&a.items.length>0)for(var e in a.items)if(a.items.hasOwnProperty(e)){"text"==a.items[e].type;var f=this.processItem(a.items[e]);b.appendChild(f)}break;case"text":b=document.createTextNode(a.content);break;case"link":var b=document.createElement("a"),g=document.createTextNode(a.content);b.appendChild(g);break;case"list":if(b="ordered"==a.flavour?document.createElement("ol"):document.createElement("ul"),"undefined"!=typeof a.items)for(var e in a.items)a.items.hasOwnProperty(e)&&b.appendChild(this.processItem(a.items[e]));break;case"list-item":b=document.createElement("li");var d=document.createTextNode(a.content);b.appendChild(d);break;case"image":b=document.createElement("image")}if("undefined"!=typeof b&&null!=b&&"undefined"!=typeof a.attributes&&Object.keys(a.attributes).length>0)for(var e in a.attributes)a.attributes.hasOwnProperty(e)&&b.setAttribute(e,a.attributes[e]);return b},this.tagToHtml=function(a,b){var c="",d=!1;if("undefined"==typeof a||null==a)return c;if("undefined"!=typeof a.tagName&&("A"==a.tagName||"a"==a.tagName)&&(d=!0),("undefined"==typeof b||null==b)&&(b=0),"undefined"!=typeof b&&b>0)for(var e=0;b>e;e++)c+="	";if(1==d&&(c+=" "),"object"==typeof a)if("P"==a.tagName)if("undefined"!=typeof a.childNodes&&a.childNodes.length>1){c+="<p>";for(var f=null,g=document.createNodeIterator(a,NodeFilter.SHOW_ALL),h=0;f=g.nextNode();)h>0&&(c+=this.tagToHtml(f)),h++;c+="</p>"}else{var i=document.createElement("div");i.appendChild(a),c+=i.innerHTML}else if("A"==a.tagName){var i=document.createElement("div");i.appendChild(a),c+=i.innerHTML}else{var i=document.createElement("div");i.appendChild(a),c+=i.innerHTML}else c+=a;return 1==d&&(c+=" "),c},this.removeItem=function(a,b){return b.previousIndex=a,d.deletedItems.push(b),this.markob.items.splice(a,1)},this.reinstateDeleted=function(a,b){var c;return this.markob.items.push(b),"undefined"!=typeof b.previousIndex&&(c=this.markob.items.indexOf(b),"undefined"!=typeof c&&c!==b.previousIndex&&this.markob.items.move(c,b.previousIndex)),d.deletedItems.splice(a,1)},this.moveItemUp=function(a,b){return 0===a?!1:this.markob.items.move(a,a-1)},this.moveItemDown=function(a,b){return a===this.markob.items.length-1?!1:this.markob.items.move(a,a+1)},this.setContent=function(a){switch(a){case"lorem":d.markob={meta:{version:.1},items:[{type:"heading",rank:1,content:"Lorem Ipsum",attributes:{"class":"heading"}},{type:"paragraph",content:"Quisque quis mollis tellus. Proin aliquam tellus vel nisl vestibulum pharetra. Ut aliquam turpis et tempor convallis. Donec ut enim in ligula efficitur faucibus in at massa. Suspendisse potenti. Aenean mattis arcu sit amet erat tempus"},{type:"list",flavour:"unordered",items:[{type:"list-item",content:"Sed eget suscipit sem"},{type:"list-item",content:"Etiam eleifend sodales porttitor"},{type:"list-item",content:"Pellentesque dictum porttitor nisl"}]},{type:"paragraph",content:"Suspendisse et vestibulum ex. Integer lacinia erat sed magna commodo, eget fringilla ipsum tempus. Suspendisse potenti. Fusce aliquet ultrices interdum."},{type:"image",attributes:{src:"http://placehold.it/500x250",alt:"placeholder image","class":"th"}},{type:"paragraph",content:"Morbi rhoncus justo sed dolor luctus, eu ornare nunc sollicitudin. Praesent porttitor rhoncus massa, nec finibus nibh volutpat quis."},{type:"heading",rank:2,content:"Morbi vulputate, ipsum et malesuada suscipit",attributes:{"class":"heading"}},{type:"paragraph",content:"Mauris rhoncus molestie ipsum, vitae blandit ante consequat egestas. Praesent nec nibh a velit pretium faucibus. Aenean aliquam vestibulum nibh, eget dapibus nunc maximus at. Donec auctor consequat ligula, eget imperdiet erat venenatis non. Maecenas rhoncus mi ex, et pretium erat malesuada ac. Aliquam sapien sapien, rhoncus id auctor sit amet, mollis vel justo. Integer posuere scelerisque arcu, ut mattis elit rutrum ut. In quis diam sapien."}]};break;case"owls":d.markob={meta:{version:.1},items:[{type:"heading",rank:1,content:"Owl Anatomy"},{type:"paragraph",items:[{type:"text",content:"Owls have large forward-facing eyes and ear-holes; a "},{type:"link",content:"hawk",attributes:{href:"http://en.wikipedia.org/wiki/Hawk",title:"Hawk"}},{type:"text",content:"-like"},{type:"link",content:"beak",attributes:{href:"http://en.wikipedia.org/wiki/Beak",title:"Beak"}},{type:"text",content:"; a flat face; and usually a conspicuous circle of feathers, a "},{type:"link",content:"facial disc",attributes:{href:"http://en.wikipedia.org/wiki/Facial_disc",title:"facial disc"},wrappers:["emphasis"]},{type:"text",content:"around each eye. The feathers making up this disc can be adjusted in order to sharply focus sounds that come from varying distances onto the owls' asymmetrically placed ear cavities. "}]},{type:"image",attributes:{src:"http://upload.wikimedia.org/wikipedia/commons/thumb/3/39/Athene_noctua_%28cropped%29.jpg/220px-Athene_noctua_%28cropped%29.jpg","class":"th",alt:"Little Owl"}},{type:"paragraph",items:[{type:"text",content:"Most birds of prey have eyes on the sides of their heads, but the stereoscopic nature of the owl's forward-facing eyes permits the greater sense of depth perception necessary for low-light hunting. Although owls have "},{type:"link",content:"binocular vision",attributes:{href:"http://en.wikipedia.org/wiki/Binocular_vision",title:"Binocular vision"}},{type:"text",content:", their large eyes are fixed in their sockets—as are those of other birds—so they must turn their entire head to change views. As owls are farsighted, they are unable to see clearly anything within a few centimeters of their eyes. Caught prey can be felt by owls with the use of "},{type:"link",content:"filoplumes",attributes:{href:"http://en.wikipedia.org/wiki/Filoplume",title:"Filoplumen","class":"mw-redirect"}},{type:"text",content:'—like feathers on the beak and feet that act as "feelers". Their far vision, particularly in low light, is exceptionally good.'}]},{type:"paragraph",items:[{type:"link",content:"Thanks Wikipedia!",attributes:{href:"http://en.wikipedia.org/wiki/Owl",title:"Wikipedia Owls"}}]}]};break;default:d.markob={meta:{version:.1}}}},this.setContent("lorem")}function CodeHighlighterDirective(a,b){return{restrict:"E",scope:!0,compile:function(b,c){var d=a(b.html(),!0);return b.html(""),function(a,b,c){a.$watch(d,function(a){"html"==c["class"]?a=html_beautify(a,{indent_inner_html:!0,indent_size:4,indent_char:" ",wrap_line_length:0,brace_style:"expand",unformatted:["a","sub","sup","b","i","u"],preserve_newlines:!1,max_preserve_newlines:2,indent_handlebars:!1,extra_liners:["/html"]}):"json"==c["class"]&&(a=js_beautify(a,{indent_size:4,indent_char:" ",preserve_newlines:!0,max_preserve_newlines:2}));var d=hljs.highlightAuto(a),e=d.value;b.html(e)})}}}}angular.module("cf-markobs",["cf-templates"]).controller("MarkObsTestController",MarkObsTestController).directive("prettyCode",CodeHighlighterDirective),MarkObsTestController.$inject=["$window","$scope","$sce"],CodeHighlighterDirective.$inject=["$interpolate","$window"],Object.defineProperty(Array.prototype,"move",{enumerable:!1,value:function(a,b){this.splice(b,0,this.splice(a,1)[0])}}),angular.module("cf-templates",[]);